services:
  backend:
    build:
      context: ../backend
    ports:
      # Bind backend only on localhost; public traffic should go via Caddy (HTTPS).
      - "127.0.0.1:8000:8000"
    environment:
      - DATA_DIR=/app/data
      - AGENT_TOKENS_PATH=/app/data/agent_tokens.json
      - STARTING_AIDOLLARS=100
      - EMBEDDINGS_BASE_URL=http://host.docker.internal:11434
      - EMBEDDINGS_MODEL=nomic-embed-text
      - EMBEDDINGS_TRUNCATE=256
      - EMBEDDINGS_TIMEOUT_SECONDS=30
      # Tool Gateway (web access). Use allowlist in production.
      - WEB_FETCH_ENABLED=1
      # Allowlist for agent web_fetch (tighten as needed).
      # Add a couple of fetch-friendly sources/APIs so market scans can still be cited even if some sites 403.
      - WEB_FETCH_ALLOWLIST=example.com,fiverr.com,upwork.com,freelancer.com,remoteok.com,remotive.com,reddit.com
      - WEB_FETCH_TIMEOUT_SECONDS=15
      - WEB_FETCH_MAX_BYTES=200000
      # Web search (Serper): enable Fiverr discovery (proposer searches Fiverr -> pick gig -> create sparky task).
      # Set WEB_SEARCH_ENABLED=1 and SERPER_API_KEY in .env or here (get key at serper.dev).
      # - WEB_SEARCH_ENABLED=1
      # - SERPER_API_KEY=${SERPER_API_KEY}
    volumes:
      - ../backend_data:/app/data
    extra_hosts:
      - "host.docker.internal:host-gateway"
    restart: unless-stopped

